{% extends 'layout/default.njk' %}
{# TODO: Maybe set this on the actual work? #}

{% block pageMeta %}
  {% set metaContent = {
    type: 'website',
    title: work.title,
    image: work.imgLink | replace('WIDTH', 1200),
    url: pageConfig.canonicalUri,
    description: work.description or work.title
  } %}
  {% component 'open-graph', { pageConfig: pageConfig, metaContent: metaContent } %}
  {% component 'twitter-card', { pageConfig: pageConfig, metaContent: metaContent } %}

  <meta name="description" content="{{ work.description }}" />
{% endblock %}

{% block body %}
  <script type="application/ld+json">
    {{ work | jsonLd('workLd') | safe }}
  </script>

  {% set iiifModel = {contentUrl: work.imgLink, caption: work.description, width: work.imgWidth} %}
  {% set iiifData = {infoUrl: work.imgInfo, lazyload: true, sizesQueries: '(min-width: 860px) 800px, calc(92.59vw + 22px)'} %}
  {% componentV2 'work-media', {id: id, queryString: queryString, iiifModel: iiifModel, iiifData: iiifData, trackTitle: work.title | truncate(50)} %}

  <div class="row {{ {s:6} | spacingClasses({padding: ['top', 'bottom']}) }}">
    <div class="container">
      <div class="grid">
        <div class="{{ {s: 12, m: 7, l: 8, xl: 7, shiftXl: 1} | gridClasses }} {{ {s:4} | spacingClasses({margin: ['bottom']}) }}">
          <div class="{{ {s: 5} | spacingClasses({margin: ['bottom']}) }}">
	    <h1 id="work-info" class="{{ {s:'HNM3', m:'HNM2', l:'HNM1'} | fontClasses }} {{ {s:0} | spacingClasses({margin: ['top']}) }}">{{work.title}}</h1>
            {# TODO change how meta-unit works so can use for descriptionArray too #}
            {% for metaItem in work.metaContent %}
              {% set needsDivider = not loop.last %}
            {% if metaItem.type == 'descriptionArray' %}
              <div>
                <h2 class="{{ {s:'HNM5' , m:'HNM4'} | fontClasses }} {{ {s:0} | spacingClasses({margin: ['top']}) }} {{ {s:1} | spacingClasses({margin: ['bottom']}) }}">
                  Description
                </h2>
                {% for paragraph in work.descriptionArray %}
                  <p class="{{ {s:'HNL5' , m:'HNL4'} | fontClasses }} {{ {s:2} | spacingClasses({margin: ['bottom']}) }}">
                    {{paragraph}}
                  </p>
                {% endfor %}
              </div>
            {% else %}
              {% componentV2 'meta-unit', {headingText: metaItem.heading, content: metaItem.content, includeDivider: needsDivider} %}
            {% endif %}
          {% endfor %}

            {% if work.encoreLink %}
              <div class="{{ {s:2} | spacingClasses({margin: ['top']}) }}">
                {% componentV2 'more-info-link', {name: 'View Wellcome Library catalogue record', url: work.encoreLink} %}
              </div>
            {% endif %}
          </div>

          {% set licenseInfo = work.thumbnail.license.licenseType | getLicenseInfo %}
          {% set usingThisImageData = [
            {title: 'License infomation', content: licenseInfo.humanReadableText},
            {title: 'Credit', content: work.attribution}
          ] %}

          {% componentV2 'work-drawer', {id: 'work-using-image', heading: 'Using this image'}, null, {data: usingThisImageData, topDivider: true} %}
        </div>

        <div class="{{ {s: 12, m: 5, l: 4, xl: 3} | gridClasses }} {{ {s:1} | spacingClasses({margin: ['top']}) }}">
          <h2 class="
            {{ {s:'HNM4' , m:'HNM3'} | fontClasses }}
            {{ {s:0} | spacingClasses({margin: ['top']}) }}
            {{ {s:2} | spacingClasses({margin: ['bottom']}) }}">
            Download
          </h2>

          <a
            class="{{ {s:2} | spacingClasses({margin: ['bottom']}) }} {{ {s:'HNM5' , m:'HNM4'} | fontClasses }} plain-link font-elf-green font-hover-mint flex flex--v-center"
            href="/download?uri={{ work.imgLink | convertImageUri('full', false) | urlencode }}"
            download="{{ work.id }}.jpg"
            rel="noopener noreferrer"
            data-track-event='{"category": "component", "action": "download-button:click", "label": "id:{{ work.id }}, size:original, title:{{ work.title | truncate(50) }}"}'>
            {% icon 'actions/download', null, ['icon--elf-green'] %}
            <div class="{{{s: 1} | spacingClasses({ margin: ['left'] })}}">
              Download original
            </div>
          </a>

          <a
            class="{{ {s:4} | spacingClasses({margin: ['bottom']}) }} {{ {s:'HNM5' , m:'HNM4'} | fontClasses }} plain-link font-elf-green font-hover-mint flex flex--v-center"
            href="/download?uri={{ work.imgLink | convertImageUri(760, false) | urlencode }}"
            download="{{ work.id }}.jpg"
            rel="noopener noreferrer"
            data-track-event='{"category": "component", "action": "download-button:click", "label": "id:{{ work.id }}", "size":760, "title":"{{ work.title | truncate(50) }}"}'>
            {% icon 'actions/download', null, ['icon--elf-green'] %}
            <div class="{{{s: 1} | spacingClasses({ margin: ['left'] })}}">
              Download small (760px)
            </div>
          </a>

          <div class="{{ {s:4} | spacingClasses({margin: ['bottom']}) }}">
            <p class="{{ {s:'HNL5', m:'HNL4'} | fontClasses }} {{ {s:1} | spacingClasses({margin: ['bottom']}) }}">Credit: {{ work.credit }}</p>
            {% componentV2 'license',  {subject: work.imgLink, licenseType: work.thumbnail.license.licenseType} %}
          </div>


          <div class="{{ {s:2} | spacingClasses({margin: ['top']}) }}">
            {% componentV2 'divider', null, {'pumice': true, 'keyline': true}, {extraClasses: [{s:1} | spacingClasses({margin: ['top', 'bottom']})]}  %}
            <h2 class="
              {{ {s:'HNM4' , m:'HNM3'} | fontClasses }}
              {{ {s:2} | spacingClasses({margin: ['top']}) }}
              {{ {s:1} | spacingClasses({margin: ['bottom']}) }}">
                Share
            </h2>
            {% set copyUrl = pageConfig.organization.url + pageConfig.canonicalUri %}
            {% componentV2 'copy-url', {id: work.id, url: copyUrl} %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {% componentV2 'back-to-top', {}, {trackId: pageConfig.canonicalUri} %}
{% endblock %}
