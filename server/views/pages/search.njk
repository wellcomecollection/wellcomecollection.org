{% extends 'layout/default.njk' %}

{% set metaTitle = 'Wellcome Collection search' %}
{% if query %}
  {% set metaTitle = 'Wellcome Collection search: ' + query %}
{% endif %}

{% set description = 'Explore 53,000 Artworks and Photos' %}

{% block pageMeta %}
  {% set metaContent = {
    type: 'website',
    title: metaTitle,
    image: resultsList.results[0].imgLink | replace('WIDTH', 1200),
    url: pageConfig.canonicalUri
  } %}
  {% component 'open-graph', { pageConfig: pageConfig, metaContent: metaContent } %}
  {% component 'twitter-card', { pageConfig: pageConfig, metaContent: metaContent } %}

  {% if query %}
  <meta name="description" content="A Wellcome Collection search for '{{ query }}'" />
  {% else %}
  <meta name="description" content="{{ description }}">
  {% endif %}
{% endblock %}

{% block body %}
  {% componentV2 'page-description', { title: 'Search' }, {'hidden': true} %}
  <div class="row bg-cream
    {{ {s:3, m:5} | spacingClasses({padding: ['top']}) }}
    {{ {s:3, m:4, l:6} | spacingClasses({padding: ['bottom']}) }}">
    <div class="container">
      <div class="grid">
        <div class="{{ {s:12, m:10, l:8, xl:8} | gridClasses }}">
          {% if not query %}
            <span class="font-turquoise-text caps {{ {s:'WB7', l:'WB6'} | fontClasses }}">New</span>
            <h2 class="{{ {s:'WB6', m:'WB5', l:'WB4'} | fontClasses }} {{ {s:4} | spacingClasses({margin: ['bottom']}) }} {{ {s:0} | spacingClasses({margin: ['top']}) }}">{{ description }}</h2>
          {% endif %}
          {% componentV2 'search-box', {id: 'search-works', action: '', name: 'query', query: query, autofocus: true} %}
          {% if not query %}
            <p class="{{ {s:'HNL5', m:'HNL4'} | fontClasses }} {{ {s:4} | spacingClasses({margin: ['top']}) }} {{ {s:1} | spacingClasses({margin: ['bottom']}) }}">Images are free to download and use under Creative Commons licences.</p>
            <p class="{{ {s:'HNL5', m:'HNL4'} | fontClasses }}">Visit <a class="font-elf-green" href="https://wellcomeimages.org/">Wellcome Images</a> to search all images from the collection.</p>
          {% else %}
            <p class="text--meta {{ {s:2} | spacingClasses({margin: ['top']}) }} {{ {s:2} | spacingClasses({margin: ['bottom']}) }}">
              {{ resultsList.totalResults if resultsList.totalResults > 0 else 'No' }} results for "{{ query }}"
            </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if not query %}
    <div class="row {{ {s:3, m:5} | spacingClasses({padding: ['top']}) }} {{ {s:10} | spacingClasses({padding: ['bottom'], margin: ['bottom']}) }}">
      <div class="container">
        <div class="grid">
          <div class="grid__cell">
            <h3 class="{{ {s:'WB6'} | fontClasses }}">Suggested Topics</h3>
            {% componentV2 'tags', {id: 'search-landing', tags: [
              {text: 'Quacks', url: '/works?query=quack+OR+quacks', bgColor: 'turquoise-text'},
              {text: 'James Gillray', url: '/works?query=creator%3Ajames+gillray', bgColor: 'turquoise-text'},
              {text: 'Botany', url: '/works?query=botany', bgColor: 'turquoise-text'},
              {text: 'Optics', url: '/works?query=optics', bgColor: 'turquoise-text'},
              {text: 'Sun', url: '/works?query=Sun', bgColor: 'turquoise-text'},
              {text: 'Health', url: '/works?query=health', bgColor: 'turquoise-text'},
              {text: 'Paintings', url: '/works?query=paintings', bgColor: 'turquoise-text'},
              {text: 'Science', url: '/works?query=science', bgColor: 'turquoise-text'}
            ]} %}
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {% if resultsList.totalResults > 0 %}
    <div class="row {{ {s:3, m:5} | spacingClasses({padding: ['top']}) }}">
      <div class="container">
        <div class="grid">
          <div class="grid__cell">
            <div class="flex flex--h-space-between flex--v-center">
              <div class="text--meta flex flex--v-center">
                Showing {{ pagination.range.beginning }} - {{ pagination.range.end }}
              </div>
              {% componentV2 'pagination', pagination, null, {query: query} %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row {{ {s:4} | spacingClasses({padding: ['top']}) }} ">
      <div class="container">
        <div class="grid">
          {% for result in resultsList.results %}
          <div class="{{ {s:6, m:4, l:3 , xl:2} | gridClasses }}">
            {% set img = {contentUrl: result.thumbnail.url, width: 300, height: 300} %}
            {% set type = result.type | lower %}
            {% set url = '/works/' + result.id + queryString %}
            {% componentV2 'promo', {id: result.id, contentType: type, title: result.title, url: url, image: img, datePublished: result.createdDate.label}, {}, {isConstrained: true, sizes: '(min-width: 1340px) 178px, (min-width: 960px) calc(25vw - 52px), (min-width: 600px) calc(33.24vw - 43px), calc(50vw - 27px)'} %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row {{ {s:10} | spacingClasses({padding: ['top']}) }} {{ {s:10} | spacingClasses({padding: ['bottom']}) }} ">
      <div class="container">
        <div class="grid">
          <div class="grid__cell">
            {% componentV2 'pagination', pagination, null, {query: query} %}
          </div>
        </div>
      </div>
    </div>

    {% componentV2 'back-to-top', {}, {trackId: pageConfig.canonicalUri} %}
  {% endif %}
{% endblock %}
