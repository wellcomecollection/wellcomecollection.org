{% extends 'layout/default.njk' %}

{% block pageMeta %}

{% endblock %}

{% block body %}
  {% set todayDateString = exhibitionAndEventPromos.dates.today + '|' + exhibitionAndEventPromos.dates.today %}
  {% set weekendDateString = exhibitionAndEventPromos.dates.weekend[0] + '|' + exhibitionAndEventPromos.dates.weekend[1] %}
  {% set allDateString = exhibitionAndEventPromos.dates.all[0] + '|' + exhibitionAndEventPromos.dates.all[1] %}
  {% set whatsOnModel = {
    name: 'What\'s on',
    items: [
      {id: 'today', title: 'Today', url: '/whats-on/?' + 'f[dates]' | urlencode + '=' + todayDateString | urlencode },
      {id: 'weekend', title: 'This weekend', url: '/whats-on/?' + 'f[dates]' | urlencode + '=' + weekendDateString | urlencode },
      {id: 'everything', title: 'Everything', url: '/whats-on/?' + 'f[dates]' | urlencode + '=' + allDateString | urlencode}
    ]
   } %}

  {% set whatsOnData = {activeId: exhibitionAndEventPromos.active } %}
  {% componentV2 'whats-on-list-header', whatsOnModel, {}, whatsOnData %}

  <div class="css-grid__container">
    <div class="css-grid {{ {s:2, m:4} | spacingClasses({margin: ['top']}) }}">
      {% if exhibitionAndEventPromos.active !== 'everything' %}
        {% set fromDate = exhibitionAndEventPromos.dates.queriedDates[0] %}
        {% set toDate = exhibitionAndEventPromos.dates.queriedDates[1] %}
        {% set isMoreThanOneDay =  fromDate !== toDate %}
        <p class="{{ {s:'HNM4', m:'HNM4'} | fontClasses }} {{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }} {{ {s:0} | spacingClasses({margin: ['top', 'bottom']}) }}"><time datetime="{{ fromDate }}">{{ fromDate | formatDate }}</time>{%- if isMoreThanOneDay -%}&ndash;<time datetime="{{ toDate }}">{{ toDate | formatDate }}</time>{%- endif -%}</p>
      {% endif %}
      {% if exhibitionAndEventPromos.active !== 'everything' and exhibitionAndEventPromos.active !== 'weekend' %}
        {# Single day view #}
        {% for exhibition in exhibitionAndEventPromos.temporaryExhibitionPromos %}
            <div class="{{ {s: 12, m: 6, l: 6, xl:6} | cssGridClasses }}">
              {% componentV2 'exhibition-promo', exhibition %}
            </div>
          {% endfor %}
          {% for event in exhibitionAndEventPromos.eventPromos %}
            <div class="{{ {s: 12, m: 6, l: 3, xl:3} | cssGridClasses }}">
              {% componentV2 'event-promo', event %}
            </div>
          {% endfor %}
        {% for exhibition in exhibitionAndEventPromos.permanentExhibitionPromos %}
            <div class="{{ {s: 12, m: 6, l: 6, xl:6} | cssGridClasses }}">
              {% componentV2 'exhibition-promo', exhibition %}
            </div>
          {% endfor %}
      {% else %}
        {# Multi day view #}
        <h2 class="{{ {s:'WB4'} | fontClasses }} {{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }} {{ {s:0} | spacingClasses({margin: ['top', 'bottom']}) }}">Exhibitions</h2>
        {% for exhibition in exhibitionAndEventPromos.temporaryExhibitionPromos %}
          <div class="{{ {s: 12, m: 6, l: 6, xl:6} | cssGridClasses }}">
            {% componentV2 'exhibition-promo', exhibition %}
          </div>
        {% endfor %}
        {% for exhibition in exhibitionAndEventPromos.permanentExhibitionPromos %}
          <div class="{{ {s: 12, m: 6, l: 6, xl:6} | cssGridClasses }}">
            {% componentV2 'exhibition-promo', exhibition %}
          </div>
        {% endfor %}
        {% if exhibitionAndEventPromos.active  === 'everything' %}
          <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
            {% componentV2 'divider', null, {'dashed': true} %}
          </div>
          <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
            <h2 class="{{ {s:'WB4'}  | fontClasses }} {{ {s:0} | spacingClasses({margin: ['top', 'bottom']}) }}">Events</h2>
          </div>
          {% for key, year in exhibitionAndEventPromos.eventPromosGroupedByMonth %}
            <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
              <h1>{{key}}</h1> {# TODO this just here to aid development #}
            </div>
            {% for key, month in year %}
              <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
                <h2>{{key}}</h2>
              </div>
              {% for event in month %}
                <div class="{{ {s: 12, m: 6, l: 3, xl:3} | cssGridClasses }}">
                  {% componentV2 'event-promo', event %}
                </div>
              {% endfor %}
            {% endfor %}
          {% endfor %}
        {% else %}
          {% if exhibitionAndEventPromos.eventPromos.length > 0 %}
            <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
              {% componentV2 'divider', null, {'dashed': true} %}
            </div>
            <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
              <h2 class="{{ {s:'WB4'}  | fontClasses }} {{ {s:0} | spacingClasses({margin: ['top', 'bottom']}) }}">Events</h2>
            </div>
          {% endif %}
          {% for event in exhibitionAndEventPromos.eventPromos %}
            <div class="{{ {s: 12, m: 6, l: 3, xl:3} | cssGridClasses }}">
              {% componentV2 'event-promo', event %}
            </div>
          {% endfor %}
        {% endif %}
      {% endif %}
        {# <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
          {% componentV2 'divider', null, {'dashed': true} %}
        </div>
        <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
          <h2 class="{{ {s:'WB4'}  | fontClasses }} {{ {s:0} | spacingClasses({margin: ['top', 'bottom']}) }}">Section title - TODO - find out what this should be</h2>
        </div>
        <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
          {% componentV2 'divider', null, {'dashed': true} %}
        </div>
        <div class="{{ {s: 12, m: 12, l: 12, xl:12} | cssGridClasses }}">
          <h2 class="{{ {s:'WB4'}  | fontClasses }} {{ {s:0} | spacingClasses({margin: ['top', 'bottom']}) }}">While you visit</h2>
        </div> #}
    </div>
  </div>
{% endblock %}
